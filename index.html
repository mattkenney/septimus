<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<!-- @source:https://github.com/mattkenney/septimus -->
<title>Philly Train</title>
<meta content="width=device-width, initial-scale=1, user-scalable = no" name="viewport" />
<link href='//fonts.googleapis.com/css?family=Tauri' rel="stylesheet" type="text/css" />
<link href="/css/themes/septimus.min.css" rel="stylesheet" type="text/css" />
<link href="//cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.3.1/jquery.mobile.structure.css" rel="stylesheet" type="text/css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.0/jquery.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-mobile/1.3.1/jquery.mobile.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
(function(){var h=["30th Street Station","49th St","Airport Terminal A","Airport Terminal B","Airport Terminal C-D","Airport Terminal E-F","Allegheny","Allen Lane","Ambler","Angora","Ardmore","Ardsley","Bala","Berwyn","Bethayres","Bridesburg","Bristol","Bryn Mawr","Carpenter","Chalfont","Chelten Avenue","Cheltenham","Chester TC","Chestnut Hill East","Chestnut Hill West","Churchmans Crossing","Claymont","Clifton-Aldan","Colmar","Conshohocken","Cornwells Heights","Crestmont","Croydon","Crum Lynne","Curtis Park","Cynwyd","Darby","Daylesford","Delaware Valley College","Devon","Downingtown","Doylestown","East Falls","Eastwick Station","Eddington","Eddystone","Elkins Park","Elm St","Elwyn Station","Exton","Fern Rock TC","Fernwood","Folcroft","Forest Hills","Ft Washington","Fortuna","Fox Chase","Germantown","Gladstone","Glenolden","Glenside","Gravers","Gwynedd Valley","Hatboro","Haverford","Highland","Highland Ave","Holmesburg Jct","Ivy Ridge","Jenkintown-Wyncote","Langhorne","Lansdale","Lansdowne","Lawndale","Levittown","Link Belt","Main St","Malvern","Manayunk","Marcus Hook","Market East","Meadowbrook","Media","Melrose Park","Merion","Miquon","Morton","Mt Airy","Moylan-Rose Valley","Narberth","Neshaminy Falls","New Britain","Newark","Noble","Norristown TC","North Broad St","North Hills","North Philadelphia","North Wales","Norwood","Olney","Oreland","Overbrook","Paoli","Penllyn","Pennbrook","Philmont","Primos","Prospect Park","Queen Lane","Radnor","Ridley Park","Rosemont","Roslyn","Rydal","Ryers","Secane","Sedgwick","Sharon Hill","Somerton","Spring Mill","St. Davids","St. Martins","Stenton","Strafford","Suburban Station","Swarthmore","Tacony","Temple U","Thorndale","Torresdale","Trenton","Trevose","Tulpehocken","University City","Upsal","Villanova","Wallingford","Warminster","Washington Lane","Wayne Station","Wayne Jct","West Trenton","Whitford","Willow Grove","Wilmington","Wissahickon","Wister","Woodbourne","Wyndmoor","Wynnefield Avenue","Wynnewood","Yardley"],b={},n="",a="";
if(window.localStorage&&window.JSON){b=JSON.parse(localStorage.getItem("recent")||"[]");n=localStorage.getItem("from")||"";
a=localStorage.getItem("to")||"";}function f(){var r=$("#stopfrom input").val(),o=$("#stopto input").val();if(!r||!o){alert("First choose both a from station and a to station.");
return;}var q=k(r)[0];if(!q){alert('"'+r+'" is not a SEPTA station.');return;}var p=k(o)[0];if(!p){alert('"'+r+'" is not a SEPTA station.');
return;}n=q;a=p;$.mobile.changePage("#routes");}function l(s){if(s&&s.getHours){var p=s.getHours(),r=s.getMinutes(),q="AM",o;
if(p>12){p-=12;q="PM";}o=p+":"+String(100+r).substring(1)+q;}return o;}function m(o){return function(){b=_.filter(b,function(p){return(p.label!==o.label);
});if(window.localStorage&&window.JSON){localStorage.setItem("recent",JSON.stringify(b));}g();};}function e(o){return function(){$("#stopfrom input").val(o.from);
$("#stopto input").val(o.to);f();};}function j(r,u,v,q,x){var w=$("<li></li>").appendTo(r).jqmData("theme","c"),y=q[x+"_line"]+" "+q[x+"_train"],o=q[x+"_departure_time"]||q[x+"_depart_time"],s=q[x+"_arrival_time"],p=q[x+"_delay"];
var t=w;$("<div></div>").appendTo(t).text(y).addClass("ui-li-desc");$("<div></div>").appendTo(t).text("Depart ").append(i(o,p));
$("<div></div>").appendTo(t).text("@ "+u);$("<div></div>").appendTo(t).text("Arrive ").append(i(s,p));$("<div></div>").appendTo(t).text("@ "+v);
}function d(q,o,p){return function(){q.val(p);o.empty();o.listview("refresh");o.trigger("updatelayout");};}function i(r,q){var o=$("<span></span>");
if((/^([0-9]+) mins$/).test(q)){var s=0|RegExp.$1,p=c(r);if(p){p.setTime(p.getTime()+s*60000);}p=l(p);$("<strike></strike>").appendTo(o).text(r);
o.append(" ");$("<i></i>").appendTo(o).text(p);}else{$("<span></span>").appendTo(o).text(r);$("<span></span>").appendTo(o).text(" ("+q+")");
}return o;}function k(p){var o=p&&p.toLowerCase();return _.filter(h,function(q){return(o===q.substring(0,o.length).toLowerCase());
});}function c(s){if((/^\s*([0-9]+):([0-9]+)\s*(AM|PM)\s*$/i).test(s)){var o=0|RegExp.$1,r=0|RegExp.$2,q=RegExp.$3.toUpperCase(),p=new Date();
if(o===12){o=0;}if(q==="PM"){o+=12;}p.setHours(o);p.setMinutes(r);p.setSeconds(0);p.setMilliseconds(0);}return p;}function g(){var q=$("#recent ul"),s=_.sortBy(b,"label");
q.empty();for(var r=0;r<s.length;r++){var p=$("<li></li>").appendTo(q);var o=$("<a></a>").attr("href","javascript:void(0)").text(s[r].label).appendTo(p).click(e(s[r]));
o=$("<a></a>").attr("href","javascript:void(0)").jqmData("icon","delete").click(m(s[r])).appendTo(p);}q.listview("refresh");
q.trigger("updatelayout");$("#recent").toggle(!!s.length);}$(document).on("pageinit","#search",function(){$("#stopfrom ul,#stopto ul").on("listviewbeforefilter",function(s,r){var u=$(r.input),t=$(r.input).val().toLowerCase(),o=$(this);
o.empty();if(h&&t){var q=k(t);for(var p=0;p<q.length;p++){$("<li></li>").text(q[p]).appendTo(o).click(d(u,o,q[p]));}}o.listview("refresh");
o.trigger("updatelayout");});$("#search").on("pagebeforeshow",function(){$("#stopfrom input").val("");$("#stopto input").val("");
$("#stopfrom ul,#stopto ul").empty().listview("refresh").trigger("updatelayout");g();});$("#search form").on("submit",f);
$("#find").click(f);});$(document).on("pageinit","#routes",function(){function o(t){$.mobile.loading("hide");var q=$("#routes-list");
q.empty();if(!t||!t.length){alert("No route found?!");return;}for(var r=0;r<t.length;r++){var p=$("<li></li>").jqmData("role","list-divider").jqmData("theme","c").text(t[r].orig_departure_time+" - "+(t[r].term_arrival_time||t[r].orig_arrival_time)).appendTo(q);
j(q,n,t[r].Connection||a,t[r],"orig");if(t[r].isdirect==="true"){continue;}$("<span></span>").text(" - 1 connection").appendTo(p);
j(q,t[r].Connection,a,t[r],"term");}q.listview("refresh");q.trigger("updatelayout");var s={from:n,to:a,label:n+" - "+a};b=_.filter(b,function(u){return(u.label!==s.label);
});b.push(s);while(b.length>10){b.shift();}if(window.localStorage&&window.JSON){localStorage.setItem("recent",JSON.stringify(b));
localStorage.setItem("from",n);localStorage.setItem("to",a);}}$("#routes").on("pagebeforeshow",function(){$("#routes-list").empty().listview("refresh").trigger("updatelayout");
});$("#routes").on("pageshow",function(){if(n&&a){$.mobile.loading("show");var p=$.param({req1:n,req2:a});if(window._gaq){_gaq.push(["_trackEvent","API","NextToArrive",p]);
}$.ajax("http://www3.septa.org/hackathon/NextToArrive/",{data:p,dataType:"jsonp",error:function(){$.mobile.loading("hide");
alert("There was a problem contacting SEPTA.");},success:o});}else{setTimeout(function(){$.mobile.changePage("#search");},0);
}});});$(document).on("pageshow",function(){if(window._gaq&&$.mobile.activePage&&$.mobile.activePage[0]){_gaq.push(["_trackEvent","UI","pageshow",$.mobile.activePage[0].id]);
}});})();
/*]]>*/
</script>
</head>
<body>
<div data-role="page" id="search">
<div data-role="header"><h1>Philly Train</h1></div>
<div data-role="content">
<form action="javascript:void(0)">
<h2>Find Trip</h2>
<div id="stopfrom">
<ul data-filter="true" data-filter-placeholder="From station" data-inset="true" data-role="listview"></ul>
</div>
<div id="stopto">
<ul data-filter="true" data-filter-placeholder="To station" data-inset="true" data-role="listview"></ul>
</div>
<a href="javascript:void(0)" data-role="button" id="find">Find Trip</a>
<div id="recent">
<h2>Recent Trips</h2>
<ul data-inset="true" data-role="listview"></ul>
</div>
<div><a href="#about">About</a></div>
</form>
</div>
</div>
<div data-add-back-btn="true" data-role="page" id="routes">
<div data-role="header">
<a href="#search" data-icon="arrow-l">Back</a>
<h1>Philly Train</h1>
</div>
<div data-role="content">
<ul data-inset="true" data-role="listview" data-theme="c" id="routes-list"></ul>
</div>
</div>
<div data-add-back-btn="true" data-role="page" id="detail">
<div data-role="header">
<a href="#routes" data-icon="arrow-l">Back</a>
<h1>Philly Train</h1>
</div>
<div data-role="content">
<ul data-inset="true" data-role="listview" id="detail-list"></ul>
</div>
</div>
<div data-role="page" id="about">
<div data-role="header">
<a href="#search" data-icon="arrow-l">Back</a>
<h1>Philly Train</h1>
</div>
<div data-role="content">
<div>
Powered by <a href="http://www3.septa.org/hackathon/">SEPTA</a>.
</div>
<div>
Inspired by <a href="http://baldwin.ph">Baldwin</a>.
</div>
<div>
Developed by matt<img alt="@" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAANBJREFUKFO10LErxXEUBfDPk5IysCqljAblbcrKxiTym92/gEGGt7BJJsP9DywWBullovcnGN5o8LKQyWjw9fpSJjnTPbdzuuce/hutmkTEGHbRYA6v6OIwMx9gpBKP4xaLxTCBBdyjGxHLMFod2MdjZm5VuwHOIqKPU7RrQ4M1iIhzTGIlM1u4wzxVJMygX+Z1HBTzNE5w/dMwwGyZL3GEd9zgGdt8/+ECe9jJzA2/YFhrREyh57PGYzxhFZuZ2XzphpEy8wVLhfbwhg6u/AUfN6o0SCbgjeIAAAAASUVORK5CYII=" />phillytrain.com.
</div>
</div>
</div>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-41221215-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</body>
</html>

